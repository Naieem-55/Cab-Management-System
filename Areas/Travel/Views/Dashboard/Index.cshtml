@model TravelDashboardViewModel

@{
    ViewData["Title"] = "Travel Dashboard";
}

<div class="container-fluid">
    <h1 class="mb-4">Travel Dashboard</h1>

    @if (TempData["SuccessMessage"] != null)
    {
        <div class="alert alert-success alert-dismissible fade show" role="alert">
            @TempData["SuccessMessage"]
            <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
        </div>
    }

    <!-- Stat Cards Row 1 -->
    <div class="row g-4 mb-4">
        <div class="col-xl-4 col-md-6">
            <div class="card border-primary h-100">
                <div class="card-body">
                    <div class="d-flex justify-content-between align-items-center">
                        <div>
                            <h6 class="text-muted mb-1">Total Trips</h6>
                            <h3 class="mb-0">@Model.TotalTrips</h3>
                        </div>
                        <div class="text-primary">
                            <i class="bi bi-geo-alt fs-1"></i>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="col-xl-4 col-md-6">
            <div class="card border-warning h-100">
                <div class="card-body">
                    <div class="d-flex justify-content-between align-items-center">
                        <div>
                            <h6 class="text-muted mb-1">Active Trips</h6>
                            <h3 class="mb-0">@Model.ActiveTrips</h3>
                        </div>
                        <div class="text-warning">
                            <i class="bi bi-geo-alt-fill fs-1"></i>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="col-xl-4 col-md-6">
            <div class="card border-success h-100">
                <div class="card-body">
                    <div class="d-flex justify-content-between align-items-center">
                        <div>
                            <h6 class="text-muted mb-1">Completed Trips</h6>
                            <h3 class="mb-0">@Model.CompletedTrips</h3>
                        </div>
                        <div class="text-success">
                            <i class="bi bi-check-circle fs-1"></i>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Stat Cards Row 2 -->
    <div class="row g-4 mb-4">
        <div class="col-xl-4 col-md-6">
            <div class="card border-info h-100">
                <div class="card-body">
                    <div class="d-flex justify-content-between align-items-center">
                        <div>
                            <h6 class="text-muted mb-1">Total Vehicles</h6>
                            <h3 class="mb-0">@Model.TotalVehicles</h3>
                        </div>
                        <div class="text-info">
                            <i class="bi bi-truck fs-1"></i>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="col-xl-4 col-md-6">
            <div class="card border-success h-100">
                <div class="card-body">
                    <div class="d-flex justify-content-between align-items-center">
                        <div>
                            <h6 class="text-muted mb-1">Available Vehicles</h6>
                            <h3 class="mb-0">@Model.AvailableVehicles</h3>
                        </div>
                        <div class="text-success">
                            <i class="bi bi-truck-front fs-1"></i>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="col-xl-4 col-md-6">
            <div class="card border-danger h-100">
                <div class="card-body">
                    <div class="d-flex justify-content-between align-items-center">
                        <div>
                            <h6 class="text-muted mb-1">Overdue Maintenance</h6>
                            <h3 class="mb-0">@Model.OverdueMaintenance</h3>
                        </div>
                        <div class="text-danger">
                            <i class="bi bi-exclamation-triangle fs-1"></i>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Charts Row -->
    <div class="row g-4 mb-4">
        <div class="col-lg-6">
            <div class="card h-100">
                <div class="card-header"><h5 class="mb-0">Trip Status Distribution</h5></div>
                <div class="card-body"><canvas id="tripStatusChart"></canvas></div>
            </div>
        </div>
        <div class="col-lg-6">
            <div class="card h-100">
                <div class="card-header"><h5 class="mb-0">Vehicle Status Distribution</h5></div>
                <div class="card-body"><canvas id="vehicleStatusChart"></canvas></div>
            </div>
        </div>
    </div>

    <!-- Recent Trips -->
    <div class="row g-4">
        <div class="col-12">
            <div class="card">
                <div class="card-header">
                    <h5 class="card-title mb-0">Recent Trips</h5>
                </div>
                <div class="card-body">
                    <div class="table-responsive">
                        <table class="table table-striped table-hover">
                            <thead class="table-dark">
                                <tr>
                                    <th>Customer</th>
                                    <th>Driver</th>
                                    <th>Vehicle</th>
                                    <th>Route</th>
                                    <th>Status</th>
                                    <th>Trip Date</th>
                                </tr>
                            </thead>
                            <tbody>
                                @if (Model.RecentTrips.Any())
                                {
                                    @foreach (var trip in Model.RecentTrips)
                                    {
                                        <tr>
                                            <td><a asp-area="Travel" asp-controller="Trip" asp-action="Details" asp-route-id="@trip.Id" class="text-decoration-none">@trip.CustomerName</a></td>
                                            <td>@trip.Driver?.Employee?.Name</td>
                                            <td>@trip.Vehicle?.RegistrationNumber</td>
                                            <td>@trip.Route?.Origin &rarr; @trip.Route?.Destination</td>
                                            <td>
                                                @switch (trip.Status)
                                                {
                                                    case TripStatus.Pending:
                                                        <span class="badge bg-warning text-dark">Pending</span>
                                                        break;
                                                    case TripStatus.Confirmed:
                                                        <span class="badge bg-info">Confirmed</span>
                                                        break;
                                                    case TripStatus.InProgress:
                                                        <span class="badge bg-primary">In Progress</span>
                                                        break;
                                                    case TripStatus.Completed:
                                                        <span class="badge bg-success">Completed</span>
                                                        break;
                                                    case TripStatus.Cancelled:
                                                        <span class="badge bg-danger">Cancelled</span>
                                                        break;
                                                }
                                            </td>
                                            <td>@trip.TripDate.ToString("MMM dd, yyyy")</td>
                                        </tr>
                                    }
                                }
                                else
                                {
                                    <tr>
                                        <td colspan="6" class="text-center text-muted">No recent trips found.</td>
                                    </tr>
                                }
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

@section Scripts {
    <script>
        new Chart(document.getElementById('tripStatusChart'), {
            type: 'pie',
            data: {
                labels: @Html.Raw(Json.Serialize(Model.TripStatusLabels)),
                datasets: [{
                    data: @Html.Raw(Json.Serialize(Model.TripStatusCounts)),
                    backgroundColor: ['#ffc107', '#17a2b8', '#007bff', '#28a745', '#dc3545']
                }]
            },
            options: { responsive: true, plugins: { legend: { position: 'bottom' } } }
        });

        new Chart(document.getElementById('vehicleStatusChart'), {
            type: 'pie',
            data: {
                labels: @Html.Raw(Json.Serialize(Model.VehicleStatusLabels)),
                datasets: [{
                    data: @Html.Raw(Json.Serialize(Model.VehicleStatusCounts)),
                    backgroundColor: ['#28a745', '#007bff', '#ffc107', '#6c757d']
                }]
            },
            options: { responsive: true, plugins: { legend: { position: 'bottom' } } }
        });
    </script>
}
